<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html version="-//W3C//DTD XHTML 1.1//EN"
      xmlns="http://www.w3.org/1999/xhtml"
          xml:lang="en"
          >
<head>
  <meta charset="UTF-8">
  <script src="lib/underscore-min.js" type="text/javascript"></script>
  <script src="lib/jquery-2.1.3.min.js" type="text/javascript"></script>
  <script src="lib/rdf-ext.min.js"></script>
  <script src="lib/uduvudu.js" type="text/javascript"></script>
  <script src="js/matcher.js" type="text/javascript"></script>
  <script src="js/queries.js" type="text/javascript"></script>
  <script src="js/main.js" type="text/javascript"></script>

  <link href="lib/bootstrap.min.css" rel="stylesheet">
  <style type="text/css"> </style>

</head>

<body>
  <div id="main"> </div>
  <div id="templates"></div>

<script type="text/javascript">
 $(document).ready(function () {
    function get_request(query, options) {
        var endPointUrl = 'http://diufpc116.unifr.ch:8890/sparql';
        var uri = 'http://linkedbrainz.org';
        var format = 'text/turtle';
//        var format = 'application/rdf+xml';
//        var format = 'text/n3';
//        var format = 'application/x-json+ld';

        return endPointUrl+'?default-graph-uri='+encodeURIComponent(uri)
          +'&query='+encodeURIComponent(query)
          +'&format='+encodeURIComponent(format);
    }


    function loadArtist(name) {
      var store = new rdf.LdpStore();
      var resource = 'http://linkedbrainz.org/'+name;
      //resource = "http://musicbrainz.org/artist/00eeed6b-5897-4359-8347-b8cd28375331#_";
      var request = get_request(q2_artist_info.replace(/{artist}/g, name));
//      request = 'data/result1.n3';

      //console.log(request);

      // load styles (matcher and templates) from files
      var styles = rdf.createGraph();
      var matcher = new rdf.LdpStore();

      $('#templates').load('templates.html');
      /*
      matcher.graph('matcher.ttl', function(graph, error) {
        if (!error) {
          console.debug('matcher.tll loaded')
            styles.addAll(graph);
        }
      });
      */
      /*  var template = new rdf.LdpStore();
          template.graph('templates.ttl', function(graph, error) {
          if (!error) {styles.addAll(graph);}
          }); */


      store.graph(request, function(graph, error) {
        if (error == null) {
          console.debug('successfully loaded ' + graph.toArray().length + ' triples');
          // resource (entry for template search) is same as source in this example
          console.log(graph.toArray());
          uduvudu.process(graph, {
            resource: resource
          }, function(out) {
            // write the result of the processing in the main div
            $('#main').html(out);
          });
        } else {
          $('#main').html('<div class="alert alert-error" role="alert">Error: ' + error + '</div>');
        };
      });

    } //end loadArtist

    //loadArtist("Manowar");
    loadArtist("Madonna");
});
</script>

</body>
</html>
