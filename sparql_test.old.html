<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html version="-//W3C//DTD XHTML 1.1//EN"
      xmlns="http://www.w3.org/1999/xhtml"
          xml:lang="en"
          >
<head>
  <meta charset="UTF-8">
  <script src="lib/jquery-2.1.3.min.js" type="text/javascript"></script>
  <script src="lib/underscore-min.js" type="text/javascript"></script>
  <script src="lib/jquery.sparql.js"></script>
  <script src="lib/rdf-ext.min.js"></script>
  <script src="js/matcher.js" type="text/javascript"></script>
  <script src="lib/uduvudu.js" type="text/javascript"></script>

  <link href="lib/bootstrap.min.css" rel="stylesheet">
  <style type="text/css"> </style>

</head>
    <body>
  <div id="main">
  <img id="img" style="float:right;" src="" />
  <abstract> </abstract>
      <pre></pre>
      <div id="templates"> </templates>
  </div>
</body>
<script type="text/javascript">
 $(document).ready(function () {
    var query = `
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX foaf: <http://xmlns.com/foaf/0.1/>
      PREFIX dc: <http://purl.org/dc/elements/1.1/> 
      PREFIX mo: <http://purl.org/ontology/mo/>

      construct {
        ?artist_gid foaf:name '{artist}';
            foaf:made ?release.
                ?release_event mo:release ?release;
              dc:date ?date.
      }
    where {
      ?artist_gid foaf:name '{artist}';
          foaf:made ?release.
              ?release dc:title ?_title.
                ?release_event mo:release ?release;
            dc:date ?_date.
              bind( str(?_title) as ?title )
              bind( str(?_date) as ?date )
    }`.replace(/{artist}/g, "Manowar"); //Limit 10

    var result;

    var store = new rdf.SparqlStore({
      endpointUrl: 'http://diufpc116.unifr.ch:8890/sparql',
    });

    store.selectQuery(query, function (status, response, data) {
      console.log('log> get query http status:'+status);
      //console.log(data);
//        this.result = data
      var store2 = new LdpStore();
      // prepare visualizer templates for uduvudu
      $('#templates').load('templates.html');
      store2.graph(data, function(graph, error) {
        if (error == null) {
          //console.debug('successfully loaded ' + graph.toArray().length + 'triples');
          // resource (entry for template search) is same as source in this example
          console.log(graph);
          uduvudu.process(graph, {
            'resource': resource
          }, function(out) {
            // write the result of the processing in the main div
            $('#main').html(out);
          });
        } else {
          $('#main').html('<div class="alert alert-error" role="alert">Error: ' + error + '</div>');
        };
      });

    }, 
    {accept:'text/n3',mimeType:'text/n3'}
    );
  
  // load triples
      // charger le graph
 });

  //var queryUrl = encodeURI( url+"?query="+query+"&format=json" );
 /*
  var queryUrl = url+"?query="+ encodeURIComponent(query) +"&format=text/turtle";
  $.ajax({
     // dataType: "jsonp",
      dataType: "text",
      url: queryUrl,
    success: function( _data ) {
        if (this.dataType == "jsonp") {
            var results = _data.results.bindings;
            for ( var i in results ) {
                var res = results[i].abstract.value;
                var pic = results[i].thumbnail.value;
                $('abstract').append(res);
                $('#img').attr('src', pic);
            }
        }
        else {
            $('pre').append(_data);
        }

    }
  }); */
      </script>

</html>
