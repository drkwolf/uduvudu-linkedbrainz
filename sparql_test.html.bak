<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html version="-//W3C//DTD XHTML 1.1//EN"
      xmlns="http://www.w3.org/1999/xhtml"
          xml:lang="en"
          >
<head>
  <meta charset="UTF-8">
  <script src="lib/jquery-2.1.3.min.js" type="text/javascript"></script>
  <script src="lib/underscore-min.js" type="text/javascript"></script>
  <script src="lib/jquery.sparql.js"></script>
  <script src="lib/rdf-ext.min.js"></script>
  <script src="js/matcher.js" type="text/javascript"></script>
  <script src="lib/uduvudu.js" type="text/javascript"></script>

  <link href="lib/bootstrap.min.css" rel="stylesheet">
  <style type="text/css"> </style>

</head>

<body>
  <div id="main"> </div>
  <div id="templates"></div>

<script type="text/javascript">
 $(document).ready(function () {
    var query = `
      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
      PREFIX dct: <http://purl.org/dc/terms/>
      PREFIX foaf: <http://xmlns.com/foaf/0.1/>
      PREFIX dc: <http://purl.org/dc/elements/1.1/> 
      PREFIX mo: <http://purl.org/ontology/mo/>
      PREFIX event: <http://purl.org/NET/c4dm/event.owl#> 

      construct {
        _:albums  foaf:made ?release;
      dc:title ?title;
      dc:date ?date;
      rdfs:label ?placeTitle.
      }
      where {
        ?artist_gid foaf:name '{artist}';
        foaf:made ?release.
        ?release dc:title ?_title.
        ?release_event mo:release ?release;
        dc:date ?_date;
        event:place ?place.
        ?place rdfs:label ?placeTitle.

      bind( str(?_date) as ?date )
      bind( str(?_title) as ?title )
      } GROUP BY ?release`;

    function get_request(query, options) {
        var endPointUrl = 'http://diufpc116.unifr.ch:8890/sparql';
        var uri = 'http://linkedbrainz.org';
        var format = 'text/turtle';
//        var format = 'application/rdf+xml';
//        var format = 'text/n3';
//        var format = 'application/x-json+ld';

        return endPointUrl+'?default-graph-uri='+encodeURIComponent(uri)
          +'&query='+encodeURIComponent(query)
          +'&format='+encodeURIComponent(format);
    }


    function loadArtist(name) {
      var store = new rdf.LdpStore();
      var resource = 'http://linkedbrainz.org/'+name;
      var request = get_request(query.replace(/{artist}/g, name));

      $('#templates').load('templates.html');
      store.graph(request, function(graph, error) {
        if (error == null) {
          console.debug('successfully loaded ' + graph.toArray().length + ' triples');
          // resource (entry for template search) is same as source in this example
          console.log(graph.toArray());
          uduvudu.process(graph, {
            resource: resource
          }, function(out) {
            // write the result of the processing in the main div
            $('#main').html(out);
          });
        } else {
          $('#main').html('<div class="alert alert-error" role="alert">Error: ' + error + '</div>');
        };
      });

    } //end loadArtist

    loadArtist("Manowar");
});
</script>

</body>
</html>
